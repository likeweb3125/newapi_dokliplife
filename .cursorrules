# 프로젝트 규칙 (newapi.dokliplife.co.kr)

## 공통 규칙
- 모든 주석과 깃 등의 추가 코멘트는 한글로 작성한다.
- 정석적인 방법이 있을 때, 요행수를 쓰기 전에는 반드시 "우회 방법이 있습니다."라고 말하고 건의한 뒤 진행한다.
- API 작업 시 Swagger를 항상 업데이트하고 노출되게 한다.

## Swagger YAML · description 콜론 처리
- **description에 콜론(`:`)이 포함되면 반드시 값 전체를 따옴표로 감싼다.**  
  YAML에서 `:`는 키·값 구분자이므로, 따옴표 없이 쓰면 `YAMLSemanticError: Nested mappings are not allowed in compact mappings` 오류가 난다.
- **올바른 예:**  
  `description: "상태 블록 ID (예: room-0-statuses-0)"`  
  `description: "해당 방 상태 이력의 시작일 (YYYY-MM-DD)"`
- **잘못된 예:**  
  `description: 상태 블록 ID (예: room-0-statuses-0)`  ← 콜론 때문에 파싱 오류
- summary, example, parameters 등 **문자열 값에 콜론이 들어가는 경우에도 동일하게 따옴표로 감싼다.**

## 한국어
- 코드·주석·문서는 한국어를 사용한다.

## Sequelize DATE/DATETIME · 타임존 (KST 저장)

- **새 모델 또는 새 컬럼**에서 생성일/수정일 등 **시간 컬럼**을 넣을 때:
  - **`defaultValue: DataTypes.NOW` 사용 금지.**  
    (Node에서 `new Date()`로 값을 만들어 보내면 드라이버가 UTC로 직렬화해 DB에 +0으로 저장됨)
  - **반드시** 다음 방식 사용:
    - **생성일(createdAt 등):**  
      `defaultValue: sequelize.literal('CURRENT_TIMESTAMP')`
    - **수정일(updatedAt 등):**  
      `defaultValue: sequelize.literal('CURRENT_TIMESTAMP')`  
      (INSERT 시 VALUES에 들어가므로 `ON UPDATE CURRENT_TIMESTAMP`는 사용하지 않는다. DB 테이블 정의에서만 사용 가능.)
  - DB 연결 시 세션 타임존은 `SET time_zone = 'Asia/Seoul'` 로 이미 설정되어 있으므로,  
    `CURRENT_TIMESTAMP` / `NOW()` 는 한국 시간(KST, +9)으로 저장된다.
- **Raw SQL**에서 INSERT/UPDATE 시 현재 시각이 필요하면 `NOW()` 또는 `CURRENT_TIMESTAMP` 사용  
  (세션 타임존이 Asia/Seoul 이므로 KST로 저장됨).  
  `UTC_TIMESTAMP()` 또는 `DATE_ADD(UTC_TIMESTAMP(), INTERVAL 9 HOUR)` 같은 UTC 기반 계산은 사용하지 않는다.
- **날짜·시간 입출력 시 UTC 변환 금지**
  - DB에서 읽거나 API로 내보낼 때 `toISOString()`, `getUTC*()` 등 UTC 관련 변환을 사용하지 않는다.
  - DB 값·로컬(KST) 기준으로 그대로 입출력한다.
- **날짜·시간은 DB에 있는 그대로 표시·저장**
  - **조회(API 응답):** UTC·ISO 등으로 바꾸지 말고, DB에 저장된 값 그대로 보여준다. Raw 쿼리에서 DATETIME은 `DATE_FORMAT(컬럼, '%Y-%m-%d %H:%i:%s')` 등으로 문자열 반환하거나, Date 객체를 받을 경우 로컬(세션) 기준 문자열로 포맷하여 내보낸다.
  - **입력·저장:** 클라이언트에서 받은 값이나 서버에서 만든 시간을 UTC로 변환하지 말고, 시스템(DB 세션) 설정에 맞게 그대로 저장한다.
- 자세한 설명: `docs/sequelize_datetime_timezone.md` 참고.

